name: Docs builder

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v3
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install g++ python cmake flex bison
          sudo apt-get install doxygen-latex texlive-lang-cyrillic
          
      - name: Install doxygen
        run: |
          git clone https://github.com/doxygen/doxygen.git
          cd doxygen
          mkdir build
          cd build
          cmake -G "Unix Makefiles" ..
          make
          make install
          cd ../..
      - name: Build docs using doxygen
        run: |
          doxygen dconfig
      - name: Generate pdf documentation file
        run: |
          cd docs/latex
          make
      - name: Upload docs to github
        uses: actions/upload-artifact@v3
        with:
          name: Documentation PDF
          path: docs/latex/refman.pdf
